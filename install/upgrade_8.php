<?php
/**
 * MercuryBoard
 * Copyright (c) 2001-2004 The Mercury Development Team
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * $Id: upgrade_8.php,v 1.5 2004/02/16 03:21:32 jason Exp $
 **/

if (!defined('INSTALLER')) {
	exit('Use index.php to upgrade.');
}

$need_templates = false;

$queries[] = "UPDATE {$pre}templates SET template_html='<p class=\'copyright\'>\r\n  {\$mercury->lang->main_powered} <a href=\'http://www.mercuryboard.com\' class=\'small\'><b>MercuryBoard</b></a> [{\$mercury->version}]<br>\r\n  &copy; 2001-2004 The Mercury Development Team\r\n</p>' WHERE template_name='MAIN_COPYRIGHT'";
$queries[] = "UPDATE {$pre}templates SET template_html='<table width=\'95%\' align=\'center\' border=\'0\' cellpadding=\'4\' cellspacing=\'0\'>\r\n  <tr>\r\n    <td align=\'right\'>\r\n      <a href=\'{\$this->self}?a=pm&amp;s=send&amp;re={\$pm[\'pm_id\']}\'><img src=\'./skins/{\$this->skin}/images/message_reply.gif\' border=\'0\' title=\'{\$this->lang->pm_reply}\' alt=\'{\$this->lang->pm_reply}\'></a>\r\n      <a href=\'{\$this->self}?a=pm&amp;s=send\'><img src=\'./skins/{\$this->skin}/images/new_message.gif\' border=\'0\' title=\'{\$this->lang->pm_sendamsg}\' alt=\'{\$this->lang->pm_sendamsg}\'></a>\r\n      <a href=\'{\$this->self}?a=pm&amp;s=delete&amp;m={\$pm[\'pm_id\']}\'><img src=\'./skins/{\$this->skin}/images/delete_message.gif\' border=\'0\' title=\'{\$this->lang->pm_delete}\' alt=\'{\$this->lang->pm_delete}\'></a>\r\n    </td>\r\n  </tr>\r\n</table>\r\n\r\n{\$this->table}\r\n  <tr>\r\n    <td colspan=\'2\' class=\'header\'>{\$pm[\'pm_title\']}</td>\r\n  </tr>\r\n<tr>\r\n  <td class=\'tablelight\'>\r\n    <table border=\'0\' width=\'100%\' cellpadding=\'4\' cellspacing=\'0\'>\r\n      <tr>\r\n        <td width=\'20%\' rowspan=\'3\' class=\'tablelight\' valign=\'top\'>\r\n          <b><a href=\'{\$this->self}?a=profile&amp;w={\$pm[\'pm_from\']}\'>{\$pm[\'user_name\']}</a><br>\r\n          {\$pm[\'user_title\']}</b><br><br>\r\n          {\$pm[\'user_avatar\']}\r\n          {\$this->lang->pm_group}: {\$pm[\'group_name\']}<br>\r\n          {\$this->lang->pm_posts}: {\$pm[\'user_posts\']}<br>\r\n          {\$this->lang->pm_joined}: {\$pm[\'user_joined\']}<br><br>\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td width=\'80%\' class=\'tablelight\' valign=\'top\'>\r\n          <span class=\'medium\'>{\$pm[\'pm_message\']}</span>\r\n        </td>\r\n      </tr>\r\n      <tr>\r\n        <td valign=\'bottom\' class=\'tablelight\'>\r\n          <table border=\'0\' cellpadding=\'0\' cellspacing=\'0\' width=\'100%\'>\r\n            <tr>\r\n              <td class=\'tablelight\'><span=\'signature\'>{\$pm[\'user_signature\']}</span><hr noshade size=\'1\'></td>\r\n            </tr>\r\n            <tr>\r\n              <td class=\'tablelight\'>{\$this->lang->pm_sendon} {\$pm[\'pm_time\']}</td>\r\n            </tr>\r\n          </table>\r\n        </td>\r\n      </tr>\r\n    </table>\r\n  </td>\r\n</tr>\r\n<tr>\r\n  <td class=\'footer\'>&nbsp;</td>\r\n</tr>\r\n{\$this->etable}\r\n\r\n<table width=\'95%\' align=\'center\' border=\'0\' cellpadding=\'4\' cellspacing=\'0\'>\r\n  <tr>\r\n    <td align=\'right\'>\r\n      <a href=\'{\$this->self}?a=pm&amp;s=send&amp;re={\$pm[\'pm_id\']}\'><img src=\'./skins/{\$this->skin}/images/message_reply.gif\' border=\'0\' title=\'{\$this->lang->pm_reply}\' alt=\'{\$this->lang->pm_reply}\'></a>\r\n      <a href=\'{\$this->self}?a=pm&amp;s=send\'><img src=\'./skins/{\$this->skin}/images/new_message.gif\' border=\'0\' title=\'{\$this->lang->pm_sendamsg}\' alt=\'{\$this->lang->pm_sendamsg}\'></a>\r\n      <a href=\'{\$this->self}?a=pm&amp;s=delete&amp;m={\$pm[\'pm_id\']}\'><img src=\'./skins/{\$this->skin}/images/delete_message.gif\' border=\'0\' title=\'{\$this->lang->pm_delete}\' alt=\'{\$this->lang->pm_delete}\'></a>\r\n    </td>\r\n  </tr>\r\n</table>\r\n</table>' WHERE template_name='PM_VIEW'";
$queries[] = "UPDATE {$pre}templates SET template_html='{\$this->table}\r\n  <tr>\r\n    <td colspan=\'2\' class=\'header\'>{\$this->lang->profile_view_profile}: {\$profile[\'user_name\']}</td>\r\n  </tr>\r\n  <tr>\r\n    <td width=\'50%\' class=\'subheader\' align=\'center\'>{\$this->lang->profile_contact}</td>\r\n    <td width=\'50%\' class=\'subheader\' align=\'center\'>{\$this->lang->profile_info}</td>\r\n  </tr>\r\n  <tr>\r\n    <td class=\'tablelight\' valign=\'top\'>\r\n      <table border=\'0\' width=\'100%\' cellpadding=\'3\' cellspacing=\'0\'>\r\n        <tr>\r\n          <td width=\'30%\'><b>{\$this->lang->profile_email_address}</b></td>\r\n          <td width=\'70%\'>{\$profile[\'user_email\']}</td>\r\n        </tr>\r\n        <tr>\r\n          <td><b>{\$this->lang->profile_aim_sn}</b></td>\r\n          <td>{\$profile[\'user_aim\']}</td>\r\n        </tr>\r\n        <tr>\r\n          <td><b>{\$this->lang->profile_icq_uin}</b></td>\r\n          <td>{\$profile[\'user_icq\']}</td>\r\n        </tr>\r\n        <tr>\r\n          <td><b>{\$this->lang->profile_yahoo}</b></td>\r\n          <td>{\$profile[\'user_yahoo\']}</td>\r\n        </tr>\r\n        <tr>\r\n          <td><b>{\$this->lang->profile_msn}</b></td>\r\n          <td>{\$profile[\'user_msn\']}</td>\r\n        </tr>\r\n        <tr>\r\n          <td><b>{\$this->lang->profile_pm}</b></td>\r\n          <td>{\$profile[\'user_pm\']}</td>\r\n        </tr>\r\n      </table>\r\n    </td>\r\n    <td class=\'tablelight\' valign=\'top\'>\r\n      <table border=\'0\' width=\'100%\' cellpadding=\'3\' cellspacing=\'0\'>\r\n        <tr>\r\n          <td width=\'30%\'><b>{\$this->lang->profile_member}</b></td>\r\n          <td width=\'70%\'>{\$profile[\'group_name\']}</td>\r\n        </tr>\r\n        <tr>\r\n          <td><b>{\$this->lang->profile_member_title}</b></td>\r\n          <td>{\$profile[\'user_title\']}</td>\r\n        </tr>\r\n        <tr>\r\n          <td><b>{\$this->lang->profile_www}</b></td>\r\n          <td>{\$profile[\'user_homepage\']}</td>\r\n        </tr>\r\n        <tr>\r\n          <td><b>{\$this->lang->profile_bday}</b></td>\r\n          <td>{\$profile[\'user_birthday\']}</td>\r\n        </tr>\r\n        <tr>\r\n          <td><b>{\$this->lang->profile_location}</b></td>\r\n          <td>{\$profile[\'user_location\']}</td>\r\n        </tr>\r\n        <tr>\r\n          <td><b>{\$this->lang->profile_interest}</b></td>\r\n          <td>{\$profile[\'user_interests\']}</td>\r\n        </tr>\r\n      </table>\r\n    </td>\r\n  </tr>\r\n  <tr>\r\n    <td width=\'50%\' class=\'subheader\' align=\'center\'>{\$this->lang->profile_posts}</td>\r\n    <td width=\'50%\' class=\'subheader\' align=\'center\'>{\$this->lang->profile_av_sign}</td>\r\n  </tr>\r\n  <tr>\r\n    <td class=\'tablelight\' valign=\'top\'>\r\n      {\$PostInfo}\r\n    </td>\r\n    <td class=\'tablelight\' valign=\'top\'>\r\n      <table border=\'0\' width=\'100%\' cellpadding=\'3\' cellspacing=\'0\'>\r\n        <tr>\r\n          <td width=\'30%\'><b>{\$this->lang->profile_avatar}</b></td>\r\n          <td width=\'70%\'>{\$profile[\'user_avatar\']}</td>\r\n        </tr>\r\n        <tr>\r\n          <td colspan=\'2\'><hr noshade size=\'1\'></td>\r\n        </tr>\r\n        <tr>\r\n          <td><b>{\$this->lang->profile_signature}</b></td>\r\n          <td>{\$profile[\'user_signature\']}</td>\r\n        </tr>\r\n      </table>\r\n    </td>\r\n  </tr>\r\n{\$this->etable}' WHERE template_name='PROFILE_MAIN'";

$queries[] = "DELETE FROM {$pre}active";
$queries[] = "ALTER TABLE {$pre}active
ADD active_session varchar(32) NOT NULL default '',
DROP PRIMARY KEY,
ADD UNIQUE KEY active_session (active_session),
ADD UNIQUE KEY active_ip (active_ip)";

$queries[] = "ALTER TABLE {$pre}groups
MODIFY group_format varchar(255) NOT NULL default '%s',
ADD group_perms text NOT NULL";

$queries[] = "DROP TABLE IF EXISTS {$pre}perms";

$queries[] = "ALTER TABLE {$pre}users ADD user_perms text NOT NULL";

$queries[] = "UPDATE {$pre}groups SET group_perms='a:34:{s:10:\"board_view\";b:1;s:17:\"board_view_closed\";b:1;s:11:\"do_anything\";b:1;s:8:\"is_admin\";b:1;s:9:\"email_use\";b:1;s:10:\"forum_view\";b:1;s:11:\"post_viewip\";b:1;s:10:\"topic_view\";b:1;s:11:\"poll_create\";b:1;s:9:\"poll_vote\";b:1;s:11:\"post_create\";b:1;s:12:\"topic_create\";b:1;s:12:\"post_noflood\";b:1;s:11:\"post_delete\";b:1;s:15:\"post_delete_own\";b:1;s:12:\"topic_delete\";b:1;s:16:\"topic_delete_own\";b:1;s:9:\"post_edit\";b:1;s:13:\"post_edit_own\";b:1;s:10:\"topic_edit\";b:1;s:14:\"topic_edit_own\";b:1;s:10:\"topic_lock\";b:1;s:14:\"topic_lock_own\";b:1;s:12:\"topic_unlock\";b:1;s:16:\"topic_unlock_mod\";b:1;s:16:\"topic_unlock_own\";b:1;s:9:\"topic_pin\";b:1;s:13:\"topic_pin_own\";b:1;s:11:\"topic_unpin\";b:1;s:15:\"topic_unpin_own\";b:1;s:10:\"topic_move\";b:1;s:14:\"topic_move_own\";b:1;s:11:\"post_attach\";b:1;s:20:\"post_attach_download\";b:1;}' WHERE group_id=1";
$queries[] = "UPDATE {$pre}groups SET group_perms='a:34:{s:10:\"board_view\";b:1;s:17:\"board_view_closed\";b:0;s:11:\"do_anything\";b:1;s:8:\"is_admin\";b:0;s:9:\"email_use\";b:1;s:10:\"forum_view\";b:1;s:11:\"post_viewip\";b:0;s:10:\"topic_view\";b:1;s:11:\"poll_create\";b:1;s:9:\"poll_vote\";b:1;s:11:\"post_create\";b:1;s:12:\"topic_create\";b:1;s:12:\"post_noflood\";b:0;s:11:\"post_delete\";b:0;s:15:\"post_delete_own\";b:1;s:12:\"topic_delete\";b:0;s:16:\"topic_delete_own\";b:1;s:9:\"post_edit\";b:0;s:13:\"post_edit_own\";b:1;s:10:\"topic_edit\";b:0;s:14:\"topic_edit_own\";b:1;s:10:\"topic_lock\";b:0;s:14:\"topic_lock_own\";b:1;s:12:\"topic_unlock\";b:0;s:16:\"topic_unlock_mod\";b:0;s:16:\"topic_unlock_own\";b:1;s:9:\"topic_pin\";b:0;s:13:\"topic_pin_own\";b:0;s:11:\"topic_unpin\";b:0;s:15:\"topic_unpin_own\";b:1;s:10:\"topic_move\";b:0;s:14:\"topic_move_own\";b:1;s:11:\"post_attach\";b:1;s:20:\"post_attach_download\";b:1;}' WHERE group_id=2";
$queries[] = "UPDATE {$pre}groups SET group_perms='a:34:{s:10:\"board_view\";b:1;s:17:\"board_view_closed\";b:0;s:11:\"do_anything\";b:1;s:8:\"is_admin\";b:0;s:9:\"email_use\";b:0;s:10:\"forum_view\";b:1;s:11:\"post_viewip\";b:0;s:10:\"topic_view\";b:1;s:11:\"poll_create\";b:0;s:9:\"poll_vote\";b:1;s:11:\"post_create\";b:0;s:12:\"topic_create\";b:0;s:12:\"post_noflood\";b:0;s:11:\"post_delete\";b:0;s:15:\"post_delete_own\";b:0;s:12:\"topic_delete\";b:0;s:16:\"topic_delete_own\";b:0;s:9:\"post_edit\";b:0;s:13:\"post_edit_own\";b:0;s:10:\"topic_edit\";b:0;s:14:\"topic_edit_own\";b:0;s:10:\"topic_lock\";b:0;s:14:\"topic_lock_own\";b:0;s:12:\"topic_unlock\";b:0;s:16:\"topic_unlock_mod\";b:0;s:16:\"topic_unlock_own\";b:0;s:9:\"topic_pin\";b:0;s:13:\"topic_pin_own\";b:0;s:11:\"topic_unpin\";b:0;s:15:\"topic_unpin_own\";b:0;s:10:\"topic_move\";b:0;s:14:\"topic_move_own\";b:0;s:11:\"post_attach\";b:0;s:20:\"post_attach_download\";b:0;}' WHERE group_id=3";
$queries[] = "UPDATE {$pre}groups SET group_perms='a:34:{s:10:\"board_view\";b:0;s:17:\"board_view_closed\";b:0;s:11:\"do_anything\";b:0;s:8:\"is_admin\";b:0;s:9:\"email_use\";b:0;s:10:\"forum_view\";b:0;s:11:\"post_viewip\";b:0;s:10:\"topic_view\";b:0;s:11:\"poll_create\";b:0;s:9:\"poll_vote\";b:0;s:11:\"post_create\";b:0;s:12:\"topic_create\";b:0;s:12:\"post_noflood\";b:0;s:11:\"post_delete\";b:0;s:15:\"post_delete_own\";b:0;s:12:\"topic_delete\";b:0;s:16:\"topic_delete_own\";b:0;s:9:\"post_edit\";b:0;s:13:\"post_edit_own\";b:0;s:10:\"topic_edit\";b:0;s:14:\"topic_edit_own\";b:0;s:10:\"topic_lock\";b:0;s:14:\"topic_lock_own\";b:0;s:12:\"topic_unlock\";b:0;s:16:\"topic_unlock_mod\";b:0;s:16:\"topic_unlock_own\";b:0;s:9:\"topic_pin\";b:0;s:13:\"topic_pin_own\";b:0;s:11:\"topic_unpin\";b:0;s:15:\"topic_unpin_own\";b:0;s:10:\"topic_move\";b:0;s:14:\"topic_move_own\";b:0;s:11:\"post_attach\";b:0;s:20:\"post_attach_download\";b:0;}' WHERE group_id=4";
$queries[] = "UPDATE {$pre}groups SET group_perms='a:34:{s:10:\"board_view\";b:1;s:17:\"board_view_closed\";b:0;s:11:\"do_anything\";b:1;s:8:\"is_admin\";b:0;s:9:\"email_use\";b:0;s:10:\"forum_view\";b:1;s:11:\"post_viewip\";b:1;s:10:\"topic_view\";b:1;s:11:\"poll_create\";b:0;s:9:\"poll_vote\";b:1;s:11:\"post_create\";b:1;s:12:\"topic_create\";b:0;s:12:\"post_noflood\";b:0;s:11:\"post_delete\";b:0;s:15:\"post_delete_own\";b:0;s:12:\"topic_delete\";b:0;s:16:\"topic_delete_own\";b:0;s:9:\"post_edit\";b:0;s:13:\"post_edit_own\";b:0;s:10:\"topic_edit\";b:0;s:14:\"topic_edit_own\";b:0;s:10:\"topic_lock\";b:0;s:14:\"topic_lock_own\";b:0;s:12:\"topic_unlock\";b:0;s:16:\"topic_unlock_mod\";b:0;s:16:\"topic_unlock_own\";b:0;s:9:\"topic_pin\";b:0;s:13:\"topic_pin_own\";b:0;s:11:\"topic_unpin\";b:0;s:15:\"topic_unpin_own\";b:0;s:10:\"topic_move\";b:0;s:14:\"topic_move_own\";b:0;s:11:\"post_attach\";b:0;s:20:\"post_attach_download\";b:0;}' WHERE group_id=5";

/**
 * To do:
 * Add forums to the group permissions cube
 */

$queries[] = "UPDATE {$pre}users SET user_email_form=0 WHERE user_id=1";
?>